# Constitutional AI Backend Configuration
# Copy to .env and adjust values for your environment.
# All environment variables use CONST_ prefix.

# ═══════════════════════════════════════════════════════════════════
# Application
# ═══════════════════════════════════════════════════════════════════
CONST_APP_NAME="Constitutional AI"
CONST_APP_VERSION="2.0.0"
CONST_DEBUG=false

# ═══════════════════════════════════════════════════════════════════
# Server
# ═══════════════════════════════════════════════════════════════════
CONST_HOST=127.0.0.1
CONST_PORT=8900

# ═══════════════════════════════════════════════════════════════════
# ChromaDB (Vector Database)
# ═══════════════════════════════════════════════════════════════════
CONST_CHROMADB_PATH=/path/to/chromadb_data
CONST_PDF_CACHE_PATH=/path/to/pdf_cache

# ═══════════════════════════════════════════════════════════════════
# LLM Configuration
# ═══════════════════════════════════════════════════════════════════
# OpenAI-compatible llama-server endpoint
CONST_LLM_BASE_URL=http://localhost:8080/v1
CONST_LLM_TIMEOUT=60.0
CONST_CONSTITUTIONAL_MODEL=Ministral-3-14B-Instruct-2512-Q4_K_M.gguf
CONST_CONSTITUTIONAL_FALLBACK=Ministral-3-14B-Instruct-2512-Q4_K_M.gguf
CONST_GGUF_CONTEXT_WINDOW=8192

# ═══════════════════════════════════════════════════════════════════
# Embedding Model (Jina v3)
# ═══════════════════════════════════════════════════════════════════
CONST_EMBEDDING_MODEL=jinaai/jina-embeddings-v3
CONST_EXPECTED_EMBEDDING_DIM=1024

# ═══════════════════════════════════════════════════════════════════
# Reranking (Jina Cross-Encoder)
# ═══════════════════════════════════════════════════════════════════
CONST_RERANKING_ENABLED=true
CONST_RERANKING_MODEL=jinaai/jina-reranker-v2-base-multilingual
CONST_RERANKING_SCORE_THRESHOLD=0.1
CONST_RERANKING_TOP_N=5

# ═══════════════════════════════════════════════════════════════════
# CRAG (Corrective RAG) Pipeline
# ═══════════════════════════════════════════════════════════════════
CONST_CRAG_ENABLED=true
CONST_CRAG_ENABLE_SELF_REFLECTION=false
CONST_CRAG_GRADE_THRESHOLD=0.25
CONST_CRAG_MAX_REWRITE_ATTEMPTS=2
CONST_CRAG_GRADER_MODEL=Ministral-3-14B-Instruct-2512-Q4_K_M.gguf

# ═══════════════════════════════════════════════════════════════════
# Structured Output & Critic-Revise Loop
# ═══════════════════════════════════════════════════════════════════
CONST_STRUCTURED_OUTPUT_ENABLED=true
CONST_CRITIC_REVISE_ENABLED=true
CONST_CRITIC_MAX_REVISIONS=1

# ═══════════════════════════════════════════════════════════════════
# Search Configuration
# ═══════════════════════════════════════════════════════════════════
CONST_DEFAULT_SEARCH_LIMIT=10
CONST_SEARCH_TIMEOUT=5.0
CONST_RRF_BM25_WEIGHT=1.2
CONST_RRF_K=45.0

# ═══════════════════════════════════════════════════════════════════
# Cutover guardrails (fail-closed once migration is verified)
# ═══════════════════════════════════════════════════════════════════
# When true, the backend fails closed if it would fall back to *_bge_m3_1024
# for any requested *_jina_v3_1024 collection.
CONST_CUTOVER_ENFORCE_JINA_COLLECTIONS=false

# Optional allow-list (JSON list or comma-separated) for collections that may
# fall back even with enforcement on. Keep empty for strict cutover.
CONST_CUTOVER_ALLOWED_FALLBACK_COLLECTIONS=[]

# ═══════════════════════════════════════════════════════════════════
# Logging
# ═══════════════════════════════════════════════════════════════════
CONST_LOG_LEVEL=INFO
CONST_LOG_JSON=false
# CONST_LOG_FILE=/path/to/constitutional-ai.log

# ═══════════════════════════════════════════════════════════════════
# CORS (comma-separated or JSON list)
# ═══════════════════════════════════════════════════════════════════
# CONST_CORS_ORIGINS=["http://localhost:5173","http://localhost:3000"]

# ═══════════════════════════════════════════════════════════════════
# Test Configuration (not for production)
# ═══════════════════════════════════════════════════════════════════
# RUN_INTEGRATION_TESTS=1
# RUN_OLLAMA_TESTS=1
# DETERMINISTIC_EVAL=true

# ═══════════════════════════════════════════════════════════════════
# Authentication (optional — if not set, write operations are open)
# ═══════════════════════════════════════════════════════════════════
# WARNING: For any non-local deployment, you must set an API key (or otherwise
# ensure write endpoints are not exposed). Leaving auth disabled on a networked
# host can cause corpus/index mutation and data integrity issues.
# CONST_API_KEY=your-secret-api-key-here
